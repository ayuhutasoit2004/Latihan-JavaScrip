<!DOCTYPE html>
<html lang="id">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Todo List â€” Cute Version</title>

    <!-- Bootstrap -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Bootstrap Icons -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
      rel="stylesheet"
    />

    <style>
      body {
        background: linear-gradient(135deg, #a76392 0%, #e6f0ff 100%);
        font-family: 'Comic Sans MS', 'Poppins', cursive;
      }
      .todo-card {
        max-width: 800px;
        margin: 30px auto;
      }
      .card {
        border-radius: 20px;
        border: none;
        box-shadow: 0 6px 16px rgba(0,0,0,0.1);
        background: #eba6c8;
      }
      .btn-primary {
        background-color: #ec117e;
        border: none;
      }
      .btn-primary:hover {
        background-color: #ff4da6;
      }
      .btn-outline-danger {
        border-radius: 50%;
      }
      .list-group-item {
        border: none;
        margin-bottom: 8px;
        border-radius: 12px !important;
        background-color: #e6bedd;
        box-shadow: 0 2px 5px rgba(0,0,0,0.05);
      }
      .list-group-item.editing {
        background: #fff0f6;
      }
      .cursor-grab { cursor: grab; }
      .empty-icon {
        font-size: 3rem;
        color: #4f1c35;
      }
    </style>
  </head>
  <body>
    <div class="container todo-card">
      <div class="card">
        <div class="card-body p-4">
          <div class="text-center mb-4">
            <h2 class="fw-bold" style="color:#ff4da6"><i class="bi bi-stars"></i> MY Todo List <i class="bi bi-heart-fill"></i></h2>
            <p class="text-muted">Kelola kegiatanmu dengan happy âœ¨</p>
          </div>

          <!-- Form Tambah -->
          <form id="formAdd" class="mb-3">
            <div class="input-group">
              <input type="text" name="todo" class="form-control rounded-start-pill" placeholder="Tulis todo imutmu di sini..." autocomplete="off" />
              <button type="submit" class="btn btn-primary rounded-end-pill"><i class="bi bi-plus-circle"></i> Tambah</button>
            </div>
            <div class="form-text mt-2" id="formMsg"></div>
          </form>

          <!-- Controls: Filter + Search -->
          <div class="d-flex flex-wrap gap-2 mb-3 justify-content-between">
            <div class="btn-group" role="group">
              <button type="button" data-filter="all" class="btn btn-outline-secondary active">Semua</button>
              <button type="button" data-filter="pending" class="btn btn-outline-secondary">Belum</button>
              <button type="button" data-filter="completed" class="btn btn-outline-secondary">Selesai</button>
            </div>
            <input id="searchInput" type="search" class="form-control w-auto" placeholder="ðŸ” Cari..." />
          </div>

          <!-- List -->
          <ul id="todoList" class="list-group"></ul>

          <!-- Empty state -->
          <div id="emptyState" class="text-center text-muted mt-4" style="display:none">
            <div class="empty-icon mb-2"><i class="bi bi-emoji-frown"></i></div>
            Belum ada todo, ayo tambahkan! ðŸŒ¸
          </div>

          <div class="text-center mt-3">
            <button id="clearAllBtn" type="button" class="btn btn-sm btn-outline-danger" title="Hapus semua todo">
              <i class="bi bi-trash-fill"></i> Hapus Semua
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- SortableJS -->
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      const STORAGE_KEY = 'todos_v2_praktikum';
      let todos = [];
      let filter = 'all';
      let searchQuery = '';

      const uid = () => Date.now().toString(36) + Math.random().toString(36).slice(2,8);

      function saveTodos(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(todos)); }
      function loadTodos(){ todos = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]'); }
      function showFormMessage(msg, type=''){ const el=document.getElementById('formMsg'); el.textContent=msg; el.className= type?('form-text mt-2 text-'+type):'form-text mt-2'; }
      function isDuplicateTitle(title, excludeId=null){ const t=title.trim().toLowerCase(); return todos.some(x=>x.title.trim().toLowerCase()===t && x.id!==excludeId); }

      function renderTodos(){
        const list=document.getElementById('todoList');
        list.innerHTML='';
        const filtered=todos.filter(todo=>{
          if(filter==='pending') return !todo.completed;
          if(filter==='completed') return todo.completed;
          return true;
        }).filter(todo=>!searchQuery || todo.title.toLowerCase().includes(searchQuery.toLowerCase()));

        document.getElementById('emptyState').style.display=filtered.length? 'none':'block';

        filtered.forEach(todo=>{
          const li=document.createElement('li');
          li.className='list-group-item d-flex align-items-center justify-content-between cursor-grab';
          li.dataset.id=todo.id;

          const left=document.createElement('div');
          left.className='d-flex align-items-center gap-2 flex-fill';

          const checkbox=document.createElement('input');
          checkbox.type='checkbox';
          checkbox.className='form-check-input';
          checkbox.checked=todo.completed;
          checkbox.addEventListener('change',()=>{ todo.completed=checkbox.checked; saveTodos(); renderTodos(); });

          const label=document.createElement('span');
          label.textContent=todo.title;
          label.style.textDecoration=todo.completed?'line-through':'none';

          left.appendChild(checkbox);
          left.appendChild(label);

          const btnGroup=document.createElement('div');
          btnGroup.className='btn-group btn-group-sm';

          const editBtn=document.createElement('button');
          editBtn.className='btn btn-outline-secondary';
          editBtn.innerHTML='<i class="bi bi-pencil"></i>';
          editBtn.addEventListener('click',()=>startEdit(li,todo));

          const delBtn=document.createElement('button');
          delBtn.className='btn btn-outline-danger';
          delBtn.innerHTML='<i class="bi bi-trash"></i>';
          delBtn.addEventListener('click',()=>{ if(confirm('Hapus todo ini?')){ todos=todos.filter(t=>t.id!==todo.id); saveTodos(); renderTodos(); }});

          btnGroup.appendChild(editBtn);
          btnGroup.appendChild(delBtn);

          li.appendChild(left);
          li.appendChild(btnGroup);
          list.appendChild(li);
        });
      }

      function startEdit(li,todo){
        if(li.classList.contains('editing')) return;
        li.classList.add('editing');
        const left=li.querySelector('.flex-fill');
        left.innerHTML='';

        const input=document.createElement('input');
        input.type='text';
        input.className='form-control form-control-sm';
        input.value=todo.title;

        const saveBtn=document.createElement('button');
        saveBtn.className='btn btn-sm btn-success ms-2';
        saveBtn.innerHTML='<i class="bi bi-check-lg"></i>';

        const cancelBtn=document.createElement('button');
        cancelBtn.className='btn btn-sm btn-secondary ms-1';
        cancelBtn.innerHTML='<i class="bi bi-x-lg"></i>';

        const editor=document.createElement('div');
        editor.className='d-flex';
        editor.appendChild(input);
        editor.appendChild(saveBtn);
        editor.appendChild(cancelBtn);

        left.appendChild(editor);
        input.focus();

        saveBtn.onclick=()=>{ const newTitle=input.value.trim(); if(!newTitle){alert('Judul tidak boleh kosong');return;} if(isDuplicateTitle(newTitle,todo.id)){alert('Sudah ada judul yang sama');return;} todo.title=newTitle; saveTodos(); renderTodos(); };
        cancelBtn.onclick=()=>renderTodos();
        input.onkeydown=e=>{ if(e.key==='Enter') saveBtn.click(); if(e.key==='Escape') cancelBtn.click(); };
      }

      document.addEventListener('DOMContentLoaded',()=>{
        loadTodos();
        document.getElementById('formAdd').addEventListener('submit',e=>{
          e.preventDefault();
          const title=e.target.todo.value.trim();
          if(!title){showFormMessage('Todo tidak boleh kosong','danger');return;}
          if(isDuplicateTitle(title)){showFormMessage('Judul sudah ada','danger');return;}
          todos.unshift({id:uid(),title,completed:false});
          saveTodos();renderTodos();
          e.target.todo.value='';
          showFormMessage('Todo ditambahkan','success');
          setTimeout(()=>showFormMessage(''),1500);
        });

        document.getElementById('clearAllBtn').onclick=()=>{ if(confirm('Hapus semua todo?')){ todos=[]; saveTodos(); renderTodos(); }};
        document.querySelectorAll('[data-filter]').forEach(btn=>btn.onclick=()=>{document.querySelectorAll('[data-filter]').forEach(b=>b.classList.remove('active'));btn.classList.add('active');filter=btn.dataset.filter;renderTodos();});
        document.getElementById('searchInput').oninput=e=>{searchQuery=e.target.value.trim();renderTodos();};

        renderTodos();
        new Sortable(document.getElementById('todoList'),{animation:150,handle:'.cursor-grab',onEnd:()=>{const newOrder=[];document.querySelectorAll('#todoList li').forEach(li=>{const id=li.dataset.id;const t=todos.find(x=>x.id===id);if(t)newOrder.push(t);});todos=newOrder;saveTodos();renderTodos();}});
      });
    </script>
  </body>
</html>